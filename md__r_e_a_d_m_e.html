<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Public ITA Client for C: Intel Trust Authority C Client Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Public ITA Client for C
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Intel Trust Authority C Client Library</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md40"></a></p>
<p>Intel Trust Authority Client provides a set of C libraries for attesting different TEEs with Intel Trust Authority. Users can link the C libraries within their application and make REST calls to Intel Trust Authority for fetching token containing information about the TEE attested that can be verified.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
System Requirement</h1>
<p>Use <b>Ubuntu 20.04</b>.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Installation</h1>
<p>Install the latest version of the library with following commands:</p>
<p>Follow the build instructions of library from <a class="el" href="md_docs_2builds.html">builds.md</a></p>
<p>Installation steps:</p><ol type="1">
<li>Copy the libraries built from above steps to application path and export them to LD_LIBRARY_PATH.</li>
<li>LD_LIBRARY_PATH=$LD_LIBRARY_PATH:&lt;path to libraries generated.&gt;</li>
<li>export LD_LIBRARY_PATH</li>
</ol>
<h1><a class="anchor" id="autotoc_md43"></a>
Usage</h1>
<p>If User has interface to get the quote/evidence and want to attest it with Intel Trust Authority:</p>
<p>Create a new Intel Trust Authority client, then use the exposed services to access different parts of the Intel Trust Authority API.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
Create Connector instance.</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structtrust__authority__connector.html">trust_authority_connector</a> *connector = NULL;</div>
<div class="line"> status = <a class="code hl_function" href="connector_8h.html#aafd0e8316022be51da4af55f4b19156f">trust_authority_connector_new</a>(&amp;connector, ta_key, ta_api_url, retry_max, retry_wait_sec);</div>
<div class="ttc" id="aconnector_8h_html_aafd0e8316022be51da4af55f4b19156f"><div class="ttname"><a href="connector_8h.html#aafd0e8316022be51da4af55f4b19156f">trust_authority_connector_new</a></div><div class="ttdeci">TRUST_AUTHORITY_STATUS trust_authority_connector_new(trust_authority_connector **connector, const char *api_key, const char *api_url, const int retry_max, const int retry_wait_time)</div><div class="ttdef"><b>Definition</b> connector.c:21</div></div>
<div class="ttc" id="astructtrust__authority__connector_html"><div class="ttname"><a href="structtrust__authority__connector.html">trust_authority_connector</a></div><div class="ttdef"><b>Definition</b> types.h:77</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
To get a Intel Trust Authority signed token with Nonce</h2>
<p>Create SGX/TDX adapter using</p><ul>
<li><a class="el" href="src_2sgx_2_r_e_a_d_m_e_8md.html">sgx</a></li>
<li>tdx</li>
</ul>
<p>Use the adapter created with following piece of code:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structtoken.html">token</a> <a class="code hl_struct" href="structtoken.html">token</a> = {0};</div>
<div class="line"><a class="code hl_struct" href="structpolicies.html">policies</a> <a class="code hl_struct" href="structpolicies.html">policies</a> = {0};</div>
<div class="line"><a class="code hl_struct" href="structcollect__token__args.html">collect_token_args</a> token_args ={0};</div>
<div class="line"><a class="code hl_struct" href="structevidence__adapter.html">evidence_adapter</a> *adapter = NULL;</div>
<div class="line"><span class="keywordtype">char</span> *ids[] = {policy_id};</div>
<div class="line"><a class="code hl_struct" href="structpolicies.html">policies</a>.<a class="code hl_variable" href="structpolicies.html#a8971760d7a1219e116f05e028b2c9cc6">ids</a> = ids;</div>
<div class="line"><a class="code hl_struct" href="structpolicies.html">policies</a>.<a class="code hl_variable" href="structpolicies.html#a86988a65e0d3ece7990c032c159786d6">count</a> = <span class="comment">//Number of policies provided</span></div>
<div class="line">token_args.polices = <a class="code hl_struct" href="structpolicies.html">policies</a>;</div>
<div class="line"></div>
<div class="line">status = <a class="code hl_function" href="token__provider_8h.html#af176cb271c169d4dcc28f7246a66ddb5">collect_token</a>(connector,</div>
<div class="line">                    &amp;header,</div>
<div class="line">                    &amp;<a class="code hl_struct" href="structtoken.html">token</a>, </div>
<div class="line">                    &amp;args,</div>
<div class="line">                    adapter, <span class="comment">// recieved from adapter</span></div>
<div class="line">                    user_data, <span class="comment">// any extra data user wants to send.</span></div>
<div class="line">                    user_data_len);  <span class="comment">// length of user data.</span></div>
<div class="line">                    </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> != status)  </div>
<div class="line">{ </div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to collect token: 0x%04x\n&quot;</span>, status); </div>
<div class="line">    <span class="keywordflow">return</span> status; </div>
<div class="line">} </div>
<div class="ttc" id="astructcollect__token__args_html"><div class="ttname"><a href="structcollect__token__args.html">collect_token_args</a></div><div class="ttdef"><b>Definition</b> connector.h:27</div></div>
<div class="ttc" id="astructevidence__adapter_html"><div class="ttname"><a href="structevidence__adapter.html">evidence_adapter</a></div><div class="ttdef"><b>Definition</b> types.h:111</div></div>
<div class="ttc" id="astructpolicies_html"><div class="ttname"><a href="structpolicies.html">policies</a></div><div class="ttdef"><b>Definition</b> types.h:65</div></div>
<div class="ttc" id="astructpolicies_html_a86988a65e0d3ece7990c032c159786d6"><div class="ttname"><a href="structpolicies.html#a86988a65e0d3ece7990c032c159786d6">policies::count</a></div><div class="ttdeci">uint32_t count</div><div class="ttdef"><b>Definition</b> types.h:67</div></div>
<div class="ttc" id="astructpolicies_html_a8971760d7a1219e116f05e028b2c9cc6"><div class="ttname"><a href="structpolicies.html#a8971760d7a1219e116f05e028b2c9cc6">policies::ids</a></div><div class="ttdeci">char ** ids</div><div class="ttdef"><b>Definition</b> types.h:66</div></div>
<div class="ttc" id="astructtoken_html"><div class="ttname"><a href="structtoken.html">token</a></div><div class="ttdef"><b>Definition</b> types.h:27</div></div>
<div class="ttc" id="atoken__provider_8h_html_af176cb271c169d4dcc28f7246a66ddb5"><div class="ttname"><a href="token__provider_8h.html#af176cb271c169d4dcc28f7246a66ddb5">collect_token</a></div><div class="ttdeci">TRUST_AUTHORITY_STATUS collect_token(trust_authority_connector *connector, response_headers *resp_headers, token *token, collect_token_args *token_args, evidence_adapter *adapter, uint8_t *user_data, uint32_t user_data_len)</div><div class="ttdef"><b>Definition</b> token_provider.c:10</div></div>
<div class="ttc" id="atypes_8h_html_a74941a22ce5a95d9e9a12c620624a87da7e4a42e3b6dd63708c64cf3db6f69566"><div class="ttname"><a href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a></div><div class="ttdeci">@ STATUS_OK</div><div class="ttdef"><b>Definition</b> types.h:118</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
To verify Intel Trust Authority signed token</h2>
<p><code>char * jwks_data</code> is optional in this function. <br  />
 If user sends <code>NULL</code>, jwks will be downloaded from INTEL Trust authority server. <br  />
 Else user can send the whole <code>jwks_data</code> json in <code>char *</code> format. <br  />
</p>
<div class="fragment"><div class="line"></div>
<div class="line">status = <a class="code hl_function" href="token__verifier_8h.html#a233438b391d9f951a849a20546b0fd69">verify_token</a>(&amp;<a class="code hl_struct" href="structtoken.html">token</a>,</div>
<div class="line">                    base_url, <span class="comment">// Intel Trust Authority API URL </span></div>
<div class="line">                    jwks_data, </div>
<div class="line">                    &amp;parsed_token,</div>
<div class="line">                    retry_max, </div>
<div class="line">                    retry_wait_sec);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> != status)</div>
<div class="line">{  </div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Failed to verify token: 0x%04x\n&quot;</span>, status);  </div>
<div class="line">        <span class="keywordflow">return</span> status;  </div>
<div class="line">}  </div>
<div class="ttc" id="atoken__verifier_8h_html_a233438b391d9f951a849a20546b0fd69"><div class="ttname"><a href="token__verifier_8h.html#a233438b391d9f951a849a20546b0fd69">verify_token</a></div><div class="ttdeci">TRUST_AUTHORITY_STATUS verify_token(token *token, char *trust_authority_base_url, char *trust_authority_jwks_data, jwt_t **parsed_token, int retry_max, int retry_wait_time)</div><div class="ttdef"><b>Definition</b> token_verifier.c:18</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md47"></a>
To download token signing certificates from Intel Trust Authority</h2>
<div class="fragment"><div class="line"></div>
<div class="line">result = <a class="code hl_function" href="connector_8h.html#a8d8d5b53dcee63ae575424440c265f50">get_token_signing_certificate</a>(jwks_url, </div>
<div class="line">                                    &amp;jwks_resp, </div>
<div class="line">                                    retry_max, </div>
<div class="line">                                    retry_wait_sec);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (result != <a class="code hl_enumvalue" href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> || jwks_resp == NULL)  </div>
<div class="line">{  </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da8b30ec8b566e32ca753d901b8fc19bba">STATUS_GET_SIGNING_CERT_ERROR</a>;  </div>
<div class="line">}  </div>
<div class="ttc" id="aconnector_8h_html_a8d8d5b53dcee63ae575424440c265f50"><div class="ttname"><a href="connector_8h.html#a8d8d5b53dcee63ae575424440c265f50">get_token_signing_certificate</a></div><div class="ttdeci">TRUST_AUTHORITY_STATUS get_token_signing_certificate(const char *tokensigncerturl, char **jwks, const int retry_max, const int retry_wait_time)</div><div class="ttdef"><b>Definition</b> connector.c:384</div></div>
<div class="ttc" id="atypes_8h_html_a74941a22ce5a95d9e9a12c620624a87da8b30ec8b566e32ca753d901b8fc19bba"><div class="ttname"><a href="types_8h.html#a74941a22ce5a95d9e9a12c620624a87da8b30ec8b566e32ca753d901b8fc19bba">STATUS_GET_SIGNING_CERT_ERROR</a></div><div class="ttdeci">@ STATUS_GET_SIGNING_CERT_ERROR</div><div class="ttdef"><b>Definition</b> types.h:167</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
For E2E token collection and signature verification logic refer</h2>
<p>SGX: <a class="el" href="examples_2sgx__token_2_r_e_a_d_m_e_8md.html">SGX Sample App</a> TDX: <a class="el" href="examples_2tdx__token_2_r_e_a_d_m_e_8md.html">TDX Sample App</a></p>
<h2><a class="anchor" id="autotoc_md49"></a>
Follow below link to run unit tests</h2>
<p><a class="el" href="md_docs_2build__ut__tests.html">Unit_Test.md</a></p>
<h1><a class="anchor" id="autotoc_md50"></a>
License</h1>
<p>This library is distributed under the BSD-style license found in the <a href="./LICENSE">LICENSE</a> file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
